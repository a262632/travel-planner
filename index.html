<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…è¡Œè¦åŠƒ App</title>
    <!-- PWA / iOS / Android App è¨­å®š -->
    <meta name="theme-color" content="#3b82f6"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ—…è¡Œè¦åŠƒ">

    <!-- ğŸ’¥ é—œéµ PWA ä¿®æ­£ï¼šé€£çµåˆ°ç¨ç«‹çš„ manifest.json æª”æ¡ˆ ğŸ’¥ -->
    <link rel="manifest" href="./manifest.json"> 

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        /* ç¢ºä¿åœ¨ App æ¨¡å¼ä¸‹ä¸æœƒé¡¯ç¤ºç€è¦½å™¨å…ƒä»¶ */
        @media all and (display-mode: standalone) {
            .browser-chrome { display: none; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 min-h-screen">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden">
        <header class="bg-blue-600 text-white p-4 text-center">
            <h1 class="text-2xl font-bold">æ—…ç¨‹è¦åŠƒ App</h1>
            <p class="text-sm opacity-90">æ‚¨çš„å€‹äººåŒ–è¡Œç¨‹ç®¡ç†å™¨ (è³‡æ–™å„²å­˜åœ¨æ‰‹æ©Ÿ)</p>
        </header>

        <div class="p-4 sm:p-6 space-y-6">
            
            <!-- æ–°å¢è¡Œç¨‹è¡¨å–® -->
            <div class="bg-gray-50 p-4 rounded-xl shadow-md">
                <h2 class="text-xl font-semibold mb-3 text-gray-700">æ–°å¢æˆ–ç·¨è¼¯è¡Œç¨‹</h2>
                <form id="tripForm" class="space-y-4">
                    <input type="hidden" id="tripId">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700">æ—¥æœŸ</label>
                        <input type="date" id="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700">æ™‚é–“ (é¸å¡«)</label>
                        <input type="time" id="time" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    </div>
                    <div>
                        <label for="activity" class="block text-sm font-medium text-gray-700">æ´»å‹•/åœ°é»</label>
                        <input type="text" id="activity" required placeholder="ä¾‹å¦‚: é£¯åº—Check-in, æ·ºè‰å¯º" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700">å‚™è¨» (é¸å¡«)</label>
                        <textarea id="notes" rows="2" placeholder="ä¾‹å¦‚: éœ€å…ˆé ç´„ã€äº¤é€šæ–¹å¼" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2"></textarea>
                    </div>
                    <div class="flex space-x-3">
                        <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl hover:bg-blue-700 transition duration-150 shadow-lg">
                            <span id="formButtonText">æ–°å¢è¡Œç¨‹</span>
                        </button>
                        <button type="button" id="cancelEdit" class="w-auto bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-xl hover:bg-gray-400 transition duration-150 shadow-md hidden">
                            å–æ¶ˆç·¨è¼¯
                        </button>
                    </div>
                </form>
            </div>

            <!-- è¡Œç¨‹åˆ—è¡¨ -->
            <div class="space-y-4">
                <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">è¡Œç¨‹åˆ—è¡¨</h2>
                <div id="tripList" class="space-y-3">
                    <!-- è¡Œç¨‹é …ç›®å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    <p id="noTripsMessage" class="text-gray-500 text-center py-4">ç›®å‰æ²’æœ‰è¡Œç¨‹ï¼Œè«‹æ–°å¢è¡Œç¨‹ã€‚</p>
                </div>
            </div>

            <!-- è¼”åŠ©æŒ‰éˆ• -->
            <div class="flex justify-end pt-4 border-t">
                <button id="clearAll" class="text-sm text-red-600 hover:text-red-800 transition duration-150">
                    æ¸…ç©ºæ‰€æœ‰è¡Œç¨‹
                </button>
            </div>

        </div>
    </div>

    <!-- å½ˆå‡ºå¼è¨Šæ¯æ¡† -->
    <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 class="text-xl font-bold mb-3 text-red-600">ç¢ºèªæ¸…ç©º</h3>
            <p class="mb-4">æ‚¨ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¡Œç¨‹å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•å¾©åŸã€‚</p>
            <div class="flex justify-end space-x-3">
                <button id="confirmClear" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-150">
                    ç¢ºå®šæ¸…ç©º
                </button>
                <button id="cancelClear" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-150">
                    å–æ¶ˆ
                </button>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('tripForm');
        const tripList = document.getElementById('tripList');
        const noTripsMessage = document.getElementById('noTripsMessage');
        const clearAllButton = document.getElementById('clearAll');
        const messageBox = document.getElementById('messageBox');
        const confirmClearButton = document.getElementById('confirmClear');
        const cancelClearButton = document.getElementById('cancelClear');
        const cancelEditButton = document.getElementById('cancelEdit');
        const formButtonText = document.getElementById('formButtonText');
        
        let editingTripId = null;

        // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æ´ Local Storage
        if (typeof(Storage) === "undefined") {
            // ä½¿ç”¨ toast æˆ– custom alert æ›¿ä»£åŸç”Ÿçš„ alert
            console.error('æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´æœ¬åœ°å„²å­˜ï¼Œè¡Œç¨‹å°‡ç„¡æ³•ä¿å­˜ã€‚');
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šè®€å–/ä¿å­˜/æ¸²æŸ“ ---

        function getTrips() {
            try {
                const trips = localStorage.getItem('travelTrips');
                return trips ? JSON.parse(trips) : [];
            } catch (error) {
                console.error("è®€å–è¡Œç¨‹å¤±æ•—:", error);
                return [];
            }
        }

        function saveTrips(trips) {
            try {
                // æ’åºï¼šå…ˆæŒ‰æ—¥æœŸï¼Œå†æŒ‰æ™‚é–“
                trips.sort((a, b) => {
                    if (a.date !== b.date) {
                        return a.date.localeCompare(b.date);
                    }
                    // å¦‚æœæ—¥æœŸç›¸åŒï¼Œå‰‡æŒ‰æ™‚é–“æ’åº (æ²’æœ‰æ™‚é–“çš„æ’å‰é¢)
                    const timeA = a.time || '00:00';
                    const timeB = b.time || '00:00';
                    return timeA.localeCompare(timeB);
                });
                localStorage.setItem('travelTrips', JSON.stringify(trips));
            } catch (error) {
                console.error("ä¿å­˜è¡Œç¨‹å¤±æ•—:", error);
            }
        }

        function renderTrips() {
            const trips = getTrips();
            tripList.innerHTML = '';
            
            if (trips.length === 0) {
                noTripsMessage.classList.remove('hidden');
                clearAllButton.classList.add('hidden');
                return;
            }

            noTripsMessage.classList.add('hidden');
            clearAllButton.classList.remove('hidden');

            let currentGroup = '';

            trips.forEach(trip => {
                // æ—¥æœŸåˆ†çµ„é¡¯ç¤º
                if (trip.date !== currentGroup) {
                    currentGroup = trip.date;
                    const dateHeader = document.createElement('h3');
                    const formattedDate = new Date(trip.date).toLocaleDateString('zh-TW', {
                        month: 'long', 
                        day: 'numeric', 
                        weekday: 'short'
                    });
                    dateHeader.className = 'text-lg font-bold text-blue-700 mt-4 mb-2 border-l-4 border-blue-500 pl-3 pt-1 pb-1 bg-blue-50/50 rounded-md shadow-sm';
                    dateHeader.textContent = formattedDate;
                    tripList.appendChild(dateHeader);
                }

                // è¡Œç¨‹å¡ç‰‡
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-xl shadow-lg border-l-4 border-blue-500 flex justify-between items-center transition duration-150 hover:shadow-xl';
                
                const content = document.createElement('div');
                content.className = 'flex-grow min-w-0';

                const timeActivity = document.createElement('p');
                timeActivity.className = 'text-lg font-semibold text-gray-900 truncate';
                const displayTime = trip.time ? trip.time + ' - ' : '';
                timeActivity.textContent = `${displayTime}${trip.activity}`;
                
                const notes = document.createElement('p');
                notes.className = 'text-sm text-gray-500 mt-1 break-words';
                notes.textContent = trip.notes || 'ç„¡å‚™è¨»';
                
                content.appendChild(timeActivity);
                content.appendChild(notes);

                // æ“ä½œæŒ‰éˆ•å€
                const actions = document.createElement('div');
                actions.className = 'flex space-x-2 ml-4 flex-shrink-0';
                
                const editButton = document.createElement('button');
                editButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 hover:text-yellow-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-7 1l4-4m-4 4l5-5m-5 5h.01M15 5l2 2m-2-2L13 7l-2 2"/></svg>';
                editButton.title = 'ç·¨è¼¯';
                editButton.onclick = () => startEdit(trip.id);

                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 hover:text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.86 12.35A2 2 0 0116.14 21H7.86a2 2 0 01-1.99-1.65L5 7m4 0V5a2 2 0 012-2h2a2 2 0 012 2v2m-6 0h6"/></svg>';
                deleteButton.title = 'åˆªé™¤';
                deleteButton.onclick = () => deleteTrip(trip.id);

                actions.appendChild(editButton);
                actions.appendChild(deleteButton);

                card.appendChild(content);
                card.appendChild(actions);
                tripList.appendChild(card);
            });
        }

        // --- äº‹ä»¶è™•ç†å™¨ ---

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const activity = document.getElementById('activity').value;
            const notes = document.getElementById('notes').value;
            
            let trips = getTrips();
            
            if (editingTripId) {
                // ç·¨è¼¯ç¾æœ‰è¡Œç¨‹
                const index = trips.findIndex(t => t.id === editingTripId);
                if (index !== -1) {
                    trips[index] = { ...trips[index], date, time, activity, notes };
                }
                editingTripId = null;
                formButtonText.textContent = 'æ–°å¢è¡Œç¨‹';
                cancelEditButton.classList.add('hidden');
            } else {
                // æ–°å¢è¡Œç¨‹
                const newTrip = {
                    id: Date.now(), // ä½¿ç”¨æ™‚é–“æˆ³ä½œç‚ºå”¯ä¸€ ID
                    date,
                    time,
                    activity,
                    notes
                };
                trips.push(newTrip);
            }

            saveTrips(trips);
            form.reset();
            renderTrips();
        });

        function startEdit(id) {
            const trips = getTrips();
            const tripToEdit = trips.find(t => t.id === id);
            
            if (tripToEdit) {
                document.getElementById('date').value = tripToEdit.date;
                document.getElementById('time').value = tripToEdit.time;
                document.getElementById('activity').value = tripToEdit.activity;
                document.getElementById('notes').value = tripToEdit.notes;
                
                editingTripId = id;
                formButtonText.textContent = 'å„²å­˜ç·¨è¼¯';
                cancelEditButton.classList.remove('hidden');
                document.getElementById('activity').focus();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        cancelEditButton.addEventListener('click', () => {
            form.reset();
            editingTripId = null;
            formButtonText.textContent = 'æ–°å¢è¡Œç¨‹';
            cancelEditButton.classList.add('hidden');
        });

        function deleteTrip(id) {
            let trips = getTrips();
            trips = trips.filter(t => t.id !== id);
            saveTrips(trips);
            renderTrips();
        }

        // æ¸…ç©ºæ‰€æœ‰è¡Œç¨‹çš„å°è©±æ¡†é‚è¼¯
        clearAllButton.addEventListener('click', () => {
            messageBox.classList.remove('hidden');
        });

        cancelClearButton.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        confirmClearButton.addEventListener('click', () => {
            localStorage.removeItem('travelTrips');
            messageBox.classList.add('hidden');
            renderTrips();
        });

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = renderTrips;
    </script>
</body>
</html>
