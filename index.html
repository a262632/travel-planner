<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>旅行規劃 App</title>
    <!-- PWA / iOS / Android App 設定 -->
    <meta name="theme-color" content="#3b82f6"> <!-- Android 狀態列顏色 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="旅行規劃">

    <!-- PWA Manifest - 使用 Data URI 內嵌，強制 Android 進入 standalone 模式 -->
    <!-- 這是修正 Samsung 瀏覽器無法全螢幕的關鍵 -->
    <link rel="manifest" href="data:application/json;charset=utf-8, {
      "name": "旅行規劃 App",
      "short_name": "旅行規劃",
      "start_url": "./",
      "display": "standalone",
      "background_color": "#ffffff",
      "theme_color": "#3b82f6",
      "icons": [
        {
          "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzNiODJmNiI+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIvPjxwYXRoIGQ9Ik0zIDV2MTRoMThWNUgzeiIvPjxwYXRoIGQ9Ik0yMCA2aC0uOTljLS41Ni0uNTUtMS40Mi0xLTItMVMyLjk1IDIgMy43OCA0LjYyIDQgNi42NSAyLjUgOC4yNUwxLjM1IDkuNDJjLS4zMi4zMi0uNS43NS0uNSA0LjAxLS4wMSAxLjMxLjU0IDIuMTUgMS43IDEuNzEuNDYtLjE1LjctLjUyLjctLjg5cy0uMjUtLjc1LS45LS44Ny0uNjItLjQ4LS41Ny0uOTVsLjM1LTEuMTljLjEtLjMyLjQtLjU3LjgtLjg3LS40MS0uMDctLjYxLS4xNy0uNzYtLjMyLS41MS0uNjMtLjM4LTEuMTkuMzQtMS44Ni4xNS0uMTMuMTktLjI5LjE0LS40NS0uMDYtLjIuMTktLjM1LjQtLjM1aDIuNjVjLjM5IDAgLjczLjA0IDEuMDcuMTJsLjMyLjA4Yy4zMi0uMDguNjMtLjEyLjk0LS4xMi4zMSAwIC42Mi4wNCAuOTMuMTFsLjMyLjA4Yy4zNC0uMDguNjktLjE3IDEuMDctLjI1aDIuNjVjLjIxIDAgLjQ2LjE1LjQgLjM1LS4wNS4xNi0uMDEuMzIuMTQuNDUuNzIuNjcuODUgMS4yMy4zNCAxLjg2LS4xNS4xNS0uMzQuMjUtLjc2LjMyLjM4LjMtLjQxLjYtLjYyLjgyLS42Ni44MS0uNTUgMS40My0uNDcgMi4wNi4wOC41Ni40Mi44MS42NyAxLjEzLjE4LjIxLjMyLjQ0LjMyLjcyIDAgLjIyLS4wNy40Mi0uMjMuNTZsLS41MS42MmMtLjMxLjM4LS42LjY5LS42LjcyIDAgLjIyLjA3LjQ2LjIzLjU4TDIgMjAuNDJjLjM1LjIxLjc4LjMzIDEuMjUuMzMuNjUgMCAxLjI1LS4xMyAxLjg1LS40M0wxMyAyNC4wMWMtLjc2LS4xMS0xLjQ4LS4yOS0yLjE4LS41MnptLTkuNjUtMTQuNzJjLS4xOCAwLS4zNS0uMDItLjUxLS4wNi0uMDMtLjAxLS4wNi0uMDItLjEtLjA2LS4zNy0uMi0uNTctLjQ3LS42OC0uNzItLjEyLS4zMi0uMDgtLjY5LjA1LTEuMDRsLjc1LTEuOTlIMS4zNWMuMzEgMCAuNi0uMTEuODEtLjM2LjQxLS41LjM0LTEuMDItLjE2LTEuNTFsLS41OS0uNjdjLS4xNi0uMTctLjIyLS40MS0uMTYtLjY1LjA2LS4yMy4yNy0uNDIuNTUtLjU5LjI1LS4xNS41My0uMjYuOC0uMjlWNy43NWMuNjEtLjE5IDEuMDktLjMzIDEuNDktLjQ3LjIxLS4wOC4zNC0uMjguMzQtLjQ4IDAtLjE5LS4xMi0uMzktLjMyLS40Ny0uNDEtLjE1LS44NS0uMjUtMS4zMS0uMzktLjQ3LS4xNS0uODMtLjMzLTEtLjU0LS4xNC0uMTYtLjIxLS4zNS0uMjEtLjU1IDAtLjIuMDctLjQtLjE0LS40NWwxLjQtLjQ1Yy0uMTItLjA1LS4yMi0uMTItLjMyLS4xNy0uNDQtLjIyLS42Ny0uNTItLjctLjgyLS4wNS0uMjgtLjA4LS41OS0uMDgtLjkxIDAtLjQ3LjA3LS44Ni4xNy0xLjE1LjE0LS40LjQtLjcuNzYtLjk0LjI3LS4xNy41Ni0uMzUuODctLjU1Ljc2LS41MSAxLjQ3LS45NCAyLjItMS4zYy43Mi0uMzYgMS40Ny0uNTQgMi4yNy0uNTRoLjI3YzEuNTMgMCAyLjgyLjQ0IDQgMS4zMi4yMS4xLjQzLjM5LjUzLjU3LjA4LjI2LjEyLjU0LjEzLjg1IDAgLjM2LS4wOC43LS4yNSAxLjA1LS4wOS4yLS4yNS4zNy0uNTEuNDUtLjMzLjEtLjY1LjI3LS45NS40NC0uNS4zLS44NS42Ni0uOTIgMS4wOC0uMDYuMzYuMDguNzYuMzUgMS4wNS4wNy4wOC4xOC4xMy4zLjE2LjI1LjA3LjUyLjEuNzkuMDhhNC40IDQuNCAwIDAgMSAuNjUtLjA2Yy41MS0uMTguOTgtLjQxIDEuNDEtLjczLjU3LS40MiAxLS45MyAxLjI3LTEuNTguMTktLjQ0LjI4LS44OC4yOC0xLjM2VjcuODNjLS4wMS0uMTctLjA3LS4zMy0uMTgtLjQ4LS4yLS4zLS40Ni0uNTctLjc2LS44My0uNzEtLjU4LTEuNDctMS4wNy0yLjM0LTEuNDQtLjQzLS4xOC0uODgtLjMzLTEuMzYtLjQ2LS4xOC0uMDQtLjM3LS4wNy0uNTUtLjA3aC0uMDZjLS42MyAwLTEuMjUuMTEtMS44Ni4zMy0uMjQuMDgtLjUxLjE5LS43OC4zMy0uMjkuMTUtLjU2LjMyLS44LjUuMjcuMTkuNTIuMzcuNzEuNTcuNDUuNDcuNjIuOTUuNTEgMS40MS0uMTIuNDItLjQyLjgtLjg3IDEuMTQtLjMuMjMtLjY0LjQtLjk2LjU0LS42My4yOS0xLjMxLjQzLTIuMDIuNDMtLjkgMC0xLjc3LS4xNS0yLjU1LS40M1Y3LjczYzEuMTQtLjAzIDIuMDUuNjIgMi4wNSAxLjMyIDAgLjIzLS4wOC40My0uMjMuNTZsLS41MS42MmMtLjMxLjM4LS42Ljc2LS42LjczIDAgLjIyLjA3LjQyLjIzLjU2bDcuMS45NWgxLjdjLjA3LS4wMS4xMi0uMDQuMTktLjA3LjUtLjIzLjgzLS42NS44My0xLjEzIDAtLjM4LS4yNi0uNzgtLjctLjE3LS40MS0uNTMtLjc2LS45My0xLjA3LTEuMzMtLjQ3LS42Ni0uNzUtMS40LS43NS0yLjIzIDAtLjgzLjI3LTEuNS43My0yLjA3LjI3LS4zNC41NS0uNjQuODYtLjg4LjY4LS41NSAxLjQtMS4wMyAyLjItMS40Mi44Mi0uNCAxLjctLjU5IDIuNi0uNTloLjA3Yy43OSAwIDEuNTUuMTUgMi4yNS40NC4zNC4xNC42Ni4zLjkyLjQ4Ljc2LjQ4IDEuNC45OSAxLjk0IDEuNjMuMjkuMzQuNTEuNjkuNjMgMS4wNS4wOS4zNC4wNS43NC0uMDcgMS4xNi0uMDUuMTctLjIuMzQtLjQxLjQ0LS4zNS4xNi0uNzMuMjQtMS4xLjI0LS43NSAwLTEuMjYtLjU3LTEuMy0xLjMzLS4wMy0uNDcuMjUtLjg2LjctMS4wOC4xLS4wNS4xOC0uMTIuMjMtLjIuMi0uMzQuMTEtLjc0LS4xOS0xLjAyLS4zNy0uMzUtLjc5LS41Mi0xLjMtLjUyLS4yNyAwLS41My4wNS0uNzguMTItLjM4LjEyLS44LjI2LTEuMjUuNDItLjQ3LjE3LS45Ni4zNi0xLjQ0LjU2VjcuNjZjLjI0LS4wOS41LS4xOC43Ni0uMjdWMjAuMDNjLS4zMiAwLS42LS4xMS0uODItLjMyLS40My0uNS0uMzYtMS4wMi4xNS0xLjUxbDEuMjItMS4zOC0xLjA5LTEuMzFjLjQyLS40NC44OS0uODEgMS40MS0xLjA1LjE5LS4wOC4zNS0uMi4zNS0uNDIgMC0uMi0uMTItLjM3LS4zNC0uNDctLjMtLjE2LS42My0uMzItLjk2LS40OS0uNTEtLjI1LS45Ny0uNTUtMS4zNy0uOTItLjM0LS4zMS0uNjMtLjY1LS44NC0uOTYtLjE1LS4yMi0uMjQtLjQ4LS4yNC0uNzMgMC0uMy4xLS41Ny4yNy0uOC4wNy0uMDkuMjEtLjE1LjM3LS4xNWgxLjQyYy40MSAwIC44MS4wMyAxLjIxLjEuNDEuMDcuODQuMTkgMS4yNS4zNy40My4xOC44OC40MyAxLjMyLjcuNTQuMzIgMS4wNi42OCAxLjU3IDEuMDkuMTMuMTEuMjMuMjQuMjMuNDQgMCAuMjEtLjA5LjM5LS4yNi41Mi0uNTMuMzgtMS4wNi43LTEuNTggMS4wMS0uMjcuMTYtLjU2LjMtLjg2LjQyLS40OS4xNy0xIC4yOC0xLjUxLjM3LS4wNy4wMi0uMTQuMDQtLjIxLjA1VjcuNDRjLS4yNi0uMDktLjUzLS4xNy0uOC0uMjMgMS4wOS0uMDMgMi4yNS41MyAyLjI1IDEuMzQgMCAuMjEtLjA5LjQxLS4yNi41M2wtLjgxLjg1Yy0uMi4yMS0uMy40OC0uMjkuNzUgMCAuMjguMDcuNTMuMjMuNzRsMi4yNSAyLjZjLjEyLjE1LjE4LjM0LjE4LjU0IDAgLjIzLS4wOC40My0uMjMuNTZsLS41Mi42MmMtLjMxLjM4LS42Ljc2LS42LjczIDAgLjIyLjA3LjQyLjIzLjU2bDEuMTQtMS41MWMuMTktLjIzLjQtLjQ3LjYyLS43Mi43MS0uNzYgMS40NS0xLjQ0IDIuMjUtMS45NWMuNTctLjM3IDEuMTctLjY1IDEuOC0uODMuMzEtLjA5LjYzLS4xMy45NS0uMTMuODIgMCAxLjU2LjE2IDIuMjguNDcgLjM2LjE2LjY4LjM5Ljk2LjY5LjY4Ljc0IDEuMzEgMS42MiAxLjggMi42MS4xLjItLjEuNC0uMTUuNi0uMDMuMDgtLjA1LjE2LS4wNi4yNS0uMDcgLjQ1LjA5LjcuNDYgMS4xMS4zNi4zOS41LjguNCAxLjE5VjcuMzZjLjQ3LS4wOC45Ny0uMjIgMS40Ny0uNDNsMi42Ni0uOTdjLjE1LS4wNi4zLS4xLjQ3LS4xLjI4IDAgLjUzLjEyLjcxLjM0LjIgLjIyLjMxLjUuMzEuNzIgMCAuMjItLjA3LjQzLS4yMy42Yy0uMzUuMzMtLjc0LjYzLTEuMTcuOTYtLjU1LjQxLTEuMTEuNzYtMS42OCAxLjA1LS4zNi4xOC0uNzQuMzEtMS4xMy4zOWg0LjA2Yy4yNyAwIC41Mi4xMi42OS4zNC4xNy4yMi4yNi41LjI2LjcyIDAgLjIyLS4wNy40My0uMjMuNWMtLjM5LjMzLS44MS42Mi0xLjI4Ljg0LS41LjIyLTEuMDMuNDQtMS41OC42NS0uMzQuMTMtLjY5LjI1LTEuMDQuMzdWMjAuNDNjLjMxIDAgLjYtLjExLjgyLS4zMkwyMy4yNCA5LjQzYy4xNS0uMTYuMjMtLjM2LjIzLS41OCAwLS4yMi0uMDctLjQ0LS4yMy0uNTgtLjM1LS4zMy0uNzQtLjYyLTEuMTctLjg0LS40Ny0uMjItLjk3LS40MS0xLjQ4LS41Ny0uMjUtLjA4LS41LS4xMy0uNzYtLjE1VjYuNjdjLjMtLjA4LjYxLS4xNS45Mi0uMjQuNTMtLjE2IDEuMDctLjQzIDEuNTgtLjc4LjE4LS4xMi4zMS0uMzMuMzEtLjU1IDAtLjE3LS4wNy0uMzQtLjE4LS40OC0uMTYtLjIxLS40LS4zNS0uNjktLjM1aC01LjRjLS4yOSAwLS41My4xMi0uNzEuMzMtLjE1LjI2LS4yMS41NS0uMTkgLjg0VjcuMzZ6IiBmaWxsPSJ3aGl0ZSIvPjwvc3ZnPg==",
          "sizes": "192x192",
          "type": "image/svg+xml"
        }
      ]
    }">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* 隱藏 Chrome/Android 的網址列和狀態列 */
        body, html { height: 100%; overflow: auto; }
        @media all and (display-mode: standalone) {
            .browser-chrome { display: none; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 min-h-screen">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden">
        <header class="bg-blue-600 text-white p-4 text-center">
            <h1 class="text-2xl font-bold">旅程規劃 App</h1>
            <p class="text-sm opacity-90">您的個人化行程管理器 (資料儲存在手機)</p>
        </header>

        <div class="p-4 sm:p-6 space-y-6">
            
            <!-- 新增行程表單 -->
            <div class="bg-gray-50 p-4 rounded-xl shadow-md">
                <h2 class="text-xl font-semibold mb-3 text-gray-700">新增或編輯行程</h2>
                <form id="tripForm" class="space-y-4">
                    <input type="hidden" id="tripId">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700">日期</label>
                        <input type="date" id="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700">時間 (選填)</label>
                        <input type="time" id="time" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    </div>
                    <div>
                        <label for="activity" class="block text-sm font-medium text-gray-700">活動/地點</label>
                        <input type="text" id="activity" required placeholder="例如: 飯店Check-in, 淺草寺" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2">
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700">備註 (選填)</label>
                        <textarea id="notes" rows="2" placeholder="例如: 需先預約、交通方式" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2"></textarea>
                    </div>
                    <div class="flex space-x-3">
                        <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl hover:bg-blue-700 transition duration-150 shadow-lg">
                            <span id="formButtonText">新增行程</span>
                        </button>
                        <button type="button" id="cancelEdit" class="w-auto bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-xl hover:bg-gray-400 transition duration-150 shadow-md hidden">
                            取消編輯
                        </button>
                    </div>
                </form>
            </div>

            <!-- 行程列表 -->
            <div class="space-y-4">
                <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">行程列表</h2>
                <div id="tripList" class="space-y-3">
                    <!-- 行程項目將在這裡動態生成 -->
                    <p id="noTripsMessage" class="text-gray-500 text-center py-4">目前沒有行程，請新增行程。</p>
                </div>
            </div>

            <!-- 輔助按鈕 -->
            <div class="flex justify-end pt-4 border-t">
                <button id="clearAll" class="text-sm text-red-600 hover:text-red-800 transition duration-150">
                    清空所有行程
                </button>
            </div>

        </div>
    </div>

    <!-- 彈出式訊息框 -->
    <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 class="text-xl font-bold mb-3 text-red-600">確認清空</h3>
            <p class="mb-4">您確定要清空所有行程嗎？這個動作無法復原。</p>
            <div class="flex justify-end space-x-3">
                <button id="confirmClear" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-150">
                    確定清空
                </button>
                <button id="cancelClear" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition duration-150">
                    取消
                </button>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('tripForm');
        const tripList = document.getElementById('tripList');
        const noTripsMessage = document.getElementById('noTripsMessage');
        const clearAllButton = document.getElementById('clearAll');
        const messageBox = document.getElementById('messageBox');
        const confirmClearButton = document.getElementById('confirmClear');
        const cancelClearButton = document.getElementById('cancelClear');
        const cancelEditButton = document.getElementById('cancelEdit');
        const formButtonText = document.getElementById('formButtonText');
        
        let editingTripId = null;

        // 檢查瀏覽器是否支援 Local Storage
        if (typeof(Storage) === "undefined") {
            alert('抱歉，您的瀏覽器不支援本地儲存，行程將無法保存。');
        }

        // --- 核心功能：讀取/保存/渲染 ---

        function getTrips() {
            try {
                const trips = localStorage.getItem('travelTrips');
                return trips ? JSON.parse(trips) : [];
            } catch (error) {
                console.error("讀取行程失敗:", error);
                return [];
            }
        }

        function saveTrips(trips) {
            try {
                // 排序：先按日期，再按時間
                trips.sort((a, b) => {
                    if (a.date !== b.date) {
                        return a.date.localeCompare(b.date);
                    }
                    // 如果日期相同，則按時間排序 (沒有時間的排前面)
                    const timeA = a.time || '00:00';
                    const timeB = b.time || '00:00';
                    return timeA.localeCompare(timeB);
                });
                localStorage.setItem('travelTrips', JSON.stringify(trips));
            } catch (error) {
                console.error("保存行程失敗:", error);
            }
        }

        function renderTrips() {
            const trips = getTrips();
            tripList.innerHTML = '';
            
            if (trips.length === 0) {
                noTripsMessage.classList.remove('hidden');
                clearAllButton.classList.add('hidden');
                return;
            }

            noTripsMessage.classList.add('hidden');
            clearAllButton.classList.remove('hidden');

            let currentGroup = '';

            trips.forEach(trip => {
                // 日期分組顯示
                if (trip.date !== currentGroup) {
                    currentGroup = trip.date;
                    const dateHeader = document.createElement('h3');
                    const formattedDate = new Date(trip.date).toLocaleDateString('zh-TW', {
                        month: 'long', 
                        day: 'numeric', 
                        weekday: 'short'
                    });
                    dateHeader.className = 'text-lg font-bold text-blue-700 mt-4 mb-2 border-l-4 border-blue-500 pl-3 pt-1 pb-1 bg-blue-50/50 rounded-md shadow-sm';
                    dateHeader.textContent = formattedDate;
                    tripList.appendChild(dateHeader);
                }

                // 行程卡片
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-xl shadow-lg border-l-4 border-blue-500 flex justify-between items-center transition duration-150 hover:shadow-xl';
                
                const content = document.createElement('div');
                content.className = 'flex-grow min-w-0';

                const timeActivity = document.createElement('p');
                timeActivity.className = 'text-lg font-semibold text-gray-900 truncate';
                const displayTime = trip.time ? trip.time + ' - ' : '';
                timeActivity.textContent = `${displayTime}${trip.activity}`;
                
                const notes = document.createElement('p');
                notes.className = 'text-sm text-gray-500 mt-1 break-words';
                notes.textContent = trip.notes || '無備註';
                
                content.appendChild(timeActivity);
                content.appendChild(notes);

                // 操作按鈕區
                const actions = document.createElement('div');
                actions.className = 'flex space-x-2 ml-4 flex-shrink-0';
                
                const editButton = document.createElement('button');
                editButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 hover:text-yellow-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-7 1l4-4m-4 4l5-5m-5 5h.01M15 5l2 2m-2-2L13 7l-2 2"/></svg>';
                editButton.title = '編輯';
                editButton.onclick = () => startEdit(trip.id);

                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 hover:text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.86 12.35A2 2 0 0116.14 21H7.86a2 2 0 01-1.99-1.65L5 7m4 0V5a2 2 0 012-2h2a2 2 0 012 2v2m-6 0h6"/></svg>';
                deleteButton.title = '刪除';
                deleteButton.onclick = () => deleteTrip(trip.id);

                actions.appendChild(editButton);
                actions.appendChild(deleteButton);

                card.appendChild(content);
                card.appendChild(actions);
                tripList.appendChild(card);
            });
        }

        // --- 事件處理器 ---

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const activity = document.getElementById('activity').value;
            const notes = document.getElementById('notes').value;
            
            let trips = getTrips();
            
            if (editingTripId) {
                // 編輯現有行程
                const index = trips.findIndex(t => t.id === editingTripId);
                if (index !== -1) {
                    trips[index] = { ...trips[index], date, time, activity, notes };
                }
                editingTripId = null;
                formButtonText.textContent = '新增行程';
                cancelEditButton.classList.add('hidden');
            } else {
                // 新增行程
                const newTrip = {
                    id: Date.now(), // 使用時間戳作為唯一 ID
                    date,
                    time,
                    activity,
                    notes
                };
                trips.push(newTrip);
            }

            saveTrips(trips);
            form.reset();
            renderTrips();
        });

        function startEdit(id) {
            const trips = getTrips();
            const tripToEdit = trips.find(t => t.id === id);
            
            if (tripToEdit) {
                document.getElementById('date').value = tripToEdit.date;
                document.getElementById('time').value = tripToEdit.time;
                document.getElementById('activity').value = tripToEdit.activity;
                document.getElementById('notes').value = tripToEdit.notes;
                
                editingTripId = id;
                formButtonText.textContent = '儲存編輯';
                cancelEditButton.classList.remove('hidden');
                document.getElementById('activity').focus();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        cancelEditButton.addEventListener('click', () => {
            form.reset();
            editingTripId = null;
            formButtonText.textContent = '新增行程';
            cancelEditButton.classList.add('hidden');
        });

        function deleteTrip(id) {
            let trips = getTrips();
            trips = trips.filter(t => t.id !== id);
            saveTrips(trips);
            renderTrips();
        }

        // 清空所有行程的對話框邏輯
        clearAllButton.addEventListener('click', () => {
            messageBox.classList.remove('hidden');
        });

        cancelClearButton.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        confirmClearButton.addEventListener('click', () => {
            localStorage.removeItem('travelTrips');
            messageBox.classList.add('hidden');
            renderTrips();
        });

        // 頁面載入時執行
        window.onload = renderTrips;
    </script>
</body>
</html>
